name: Branch Protection

on:
  pull_request:
    types: [ opened, synchronize, reopened ]

jobs:
  enforce-branch-rules:
    name: Enforce Branch Rules
    runs-on: ubuntu-latest
    steps:
      - name: Check branch protection rules
        run: |
          echo "üîç Checking branch protection rules..."
          
          BASE_BRANCH="${{ github.event.pull_request.base.ref }}"
          HEAD_BRANCH="${{ github.event.pull_request.head.ref }}"
          
          echo "PR from: $HEAD_BRANCH ‚Üí $BASE_BRANCH"
          
          # Rule 1: Only beta can merge to main
          if [[ "$BASE_BRANCH" == "main" && "$HEAD_BRANCH" != "beta" ]]; then
            echo "‚ùå VIOLATION: Only 'beta' branch can merge to 'main'"
            echo "üîß FIX: Create PR to 'beta' branch instead"
            exit 1
          fi
          
          # Rule 2: Feature branches should target beta
          if [[ "$HEAD_BRANCH" =~ ^(feat|fix|docs|test|logs)/ && "$BASE_BRANCH" != "beta" ]]; then
            echo "‚ùå VIOLATION: Feature branches must target 'beta' branch"
            echo "üîß FIX: Change PR target to 'beta' branch"
            exit 1
          fi
          
          echo "‚úÖ All branch protection rules passed!"